<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>AI Life Coach - Xin Wan</title>
    <meta name="description" content="Personal AI-powered Life Coach"/>
    <link rel="stylesheet" href="https://latex.now.sh/style.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .chat-container {
            max-width: 800px;
            margin: 20px auto;
            height: 500px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            max-width: 70%;
        }

        .message.user {
            margin-left: auto;
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 15px 15px 0 15px;
        }

        .message.assistant {
            margin-right: auto;
            background-color: white;
            padding: 10px 15px;
            border-radius: 15px 15px 15px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .chat-input {
            padding: 20px;
            background-color: white;
            border-top: 1px solid #ccc;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .chat-input button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .chat-input button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .user-controls {
            max-width: 800px;
            margin: 20px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-controls button {
            padding: 5px 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .timestamp {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <h1>AI Life Coach</h1>
    <p><a href="index.html">[Back to Main Page]</a> <a href="projects.html">[Back to Projects]</a></p>

    <div class="content">
        <p>Welcome to your personal AI Life Coach! I'm here to help you with personal development, goal setting, and navigating life's challenges. Start a conversation below to begin your journey.</p>
        <p><a href="#" id="privacyLink">[How is my privacy respected?]</a></p>
        <div id="privacyInfo" style="display: none; max-width: 800px; margin: 20px auto; padding: 15px; background-color: #f8f9fa; border-radius: 4px;">
            <h3>Privacy Implementation</h3>
            <ul>
                <li><strong>Local Storage Only:</strong> All your chat history and personal information (including your name) are stored exclusively in your browser's local storage. This means your data never leaves your device except when you're actively chatting.</li>
                <li><strong>No External Tracking:</strong> We don't use cookies or any external tracking mechanisms. Your conversations are private to you.</li>
                <li><strong>Data Control:</strong> You have full control over your data:
                    <ul>
                        <li>Use the "Clear History" button to completely remove all stored data</li>
                        <li>Use the "Export Chat" button to download your chat history</li>
                        <li>Your data persists until you:
                            <ul>
                                <li>Clear your browser history/data</li>
                                <li>Use private/incognito browsing</li>
                                <li>Manually clear the chat history</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Chat API:</strong> When you send a message, only that message and relevant context are sent to the AI service to generate a response. No personal identification is included.</li>
            </ul>
        </div>

        <div class="user-controls">
            <span id="userStatus"></span>
            <div>
                <button id="clearHistory">Clear History</button>
                <button id="exportChat">Export Chat</button>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
            </div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Type your message here..." />
                <button id="sendButton">Send</button>
            </div>
        </div>
    </div>

    <hr>

    <footer>
        <p>Made using <a href="https://latex.vercel.app">https://latex.vercel.app</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatMessages = document.getElementById('chatMessages');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const clearHistoryBtn = document.getElementById('clearHistory');
            const exportChatBtn = document.getElementById('exportChat');
            const userStatus = document.getElementById('userStatus');
            
            const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'http://localhost:3001'
                : 'https://ai-coach-api-bzpi.onrender.com';

            // Initialize chat history from localStorage or with default message
            let chatHistory = {
                messages: [],
                userName: localStorage.getItem('aiCoach_userName') || null,
                lastVisit: localStorage.getItem('aiCoach_lastVisit') || null
            };

            function loadChatHistory() {
                const savedHistory = localStorage.getItem('aiCoach_history');
                if (savedHistory) {
                    chatHistory.messages = JSON.parse(savedHistory);
                    chatHistory.messages.forEach(msg => {
                        displayMessage(msg.content, msg.role === 'user', msg.timestamp);
                    });
                } else {
                    // Initial message for new users
                    const initialMessage = "Hello! I'm your AI Life Coach. How can I help you today with your personal development journey?";
                    addMessage(initialMessage, false);
                }

                updateUserStatus();
            }

            function updateUserStatus() {
                if (chatHistory.userName) {
                    userStatus.textContent = `Welcome back, ${chatHistory.userName}!`;
                    if (chatHistory.lastVisit) {
                        const lastVisit = new Date(parseInt(chatHistory.lastVisit));
                        userStatus.textContent += ` Last visit: ${lastVisit.toLocaleDateString()}`;
                    }
                } else {
                    userStatus.textContent = 'Welcome! Feel free to share your name during our conversation.';
                }
            }

            function displayMessage(content, isUser, timestamp) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
                messageDiv.textContent = content;

                if (timestamp) {
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'timestamp';
                    timeDiv.textContent = new Date(timestamp).toLocaleString();
                    messageDiv.appendChild(timeDiv);
                }

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function addMessage(content, isUser = false) {
                const timestamp = Date.now();
                displayMessage(content, isUser, timestamp);

                // Update chat history
                chatHistory.messages.push({
                    role: isUser ? 'user' : 'assistant',
                    content: content,
                    timestamp: timestamp
                });

                // Save to localStorage
                localStorage.setItem('aiCoach_history', JSON.stringify(chatHistory.messages));
                localStorage.setItem('aiCoach_lastVisit', timestamp);

                // Check for name in user messages
                if (isUser) {
                    const nameMention = content.match(/my name is ([A-Za-z]+)/i) || 
                                      content.match(/I'm ([A-Za-z]+)/i) ||
                                      content.match(/I am ([A-Za-z]+)/i);
                    if (nameMention && !chatHistory.userName) {
                        chatHistory.userName = nameMention[1];
                        localStorage.setItem('aiCoach_userName', chatHistory.userName);
                        updateUserStatus();
                    }
                }
            }

            async function handleSendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;

                // Disable input while processing
                messageInput.disabled = true;
                sendButton.disabled = true;

                // Add user message to chat
                addMessage(message, true);
                messageInput.value = '';

                try {
                    const response = await fetch(`${API_URL}/api/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            history: chatHistory
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'API request failed');
                    }

                    const data = await response.json();
                    addMessage(data.content);
                } catch (error) {
                    console.error('Error:', error);
                    addMessage(`Error: ${error.message}`);
                } finally {
                    // Re-enable input
                    messageInput.disabled = false;
                    sendButton.disabled = false;
                    messageInput.focus();
                }
            }

            clearHistoryBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear your chat history? This cannot be undone.')) {
                    // Clear all stored data
                    localStorage.removeItem('aiCoach_history');
                    localStorage.removeItem('aiCoach_userName');
                    localStorage.removeItem('aiCoach_lastVisit');
                    
                    // Reset chat history object
                    chatHistory = {
                        messages: [],
                        userName: null,
                        lastVisit: null
                    };
                    
                    // Clear displayed messages
                    chatMessages.innerHTML = '';
                    
                    // Reset user status
                    updateUserStatus();
                    
                    // Add initial message
                    const initialMessage = "Hello! I'm your AI Life Coach. How can I help you today with your personal development journey?";
                    addMessage(initialMessage, false);
                }
            });

            exportChatBtn.addEventListener('click', () => {
                const exportData = {
                    messages: chatHistory.messages,
                    userName: chatHistory.userName,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ai-coach-chat-history.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            // Event listeners
            sendButton.addEventListener('click', handleSendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSendMessage();
            });

            // Load chat history on startup
            loadChatHistory();

            // Privacy link toggle
            document.getElementById('privacyLink').addEventListener('click', (e) => {
                e.preventDefault();
                const privacyInfo = document.getElementById('privacyInfo');
                privacyInfo.style.display = privacyInfo.style.display === 'none' ? 'block' : 'none';
            });
        });
    </script>
</body>
</html> 